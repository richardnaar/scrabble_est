<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrabble Online</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        iframe { border: none; width: 90vw; height: 90vh; }
    </style>
</head>
<body>
    <h1>Scrabble Eesti</h1>
    <script>/* <iframe src="https://docs.google.com/spreadsheets/d/1nT-_QMeKag7tyI_H3UEfpJjMGdsoiyLfCXMpt8yNy-I/edit?usp=sharing&headers=false" width="90%" height="600px"></iframe> */</script>
    <iframe src="https://docs.google.com/spreadsheets/d/1nT-_QMeKag7tyI_H3UEfpJjMGdsoiyLfCXMpt8yNy-I/edit?usp=sharing&widget=true&chrome=false" width="90%" height="600px"></iframe>


<script>
  function enterFullScreen() {
    var elem = document.documentElement; // The whole page
    if (elem.requestFullscreen) {
      elem.requestFullscreen();
    } else if (elem.mozRequestFullScreen) { // Firefox
      elem.mozRequestFullScreen();
    } else if (elem.webkitRequestFullscreen) { // Chrome, Safari, Opera
      elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) { // IE/Edge
      elem.msRequestFullscreen();
    }
  }
</script>

<button onclick="enterFullScreen()" style="position: fixed; top: 10px; right: 10px; padding: 10px 15px; font-size: 16px;">
  Mine täisekraanile
</button>   
    <script>
  window.onload = function() {
    setTimeout(function() {
      alert("Täisekraanile minemiseks klõpsa nupul 'Mine täisekraanile' või vajuta F11.");
    }, 2000); // Shows after 2 seconds
  };
</script>

<!-- Camera Toggle Button (Top Left) -->
<button id="toggleCamera" onclick="toggleCamera()" 
        style="position: fixed; top: 10px; left: 10px; padding: 10px 15px; font-size: 16px;">
    Show Camera
</button>

<!-- Transparent Fullscreen ASCII Camera -->
<div id="ascii-cam-container" style="
    position: fixed; 
    top: 0; left: 0; 
    width: 100vw; height: 100vh; 
    background: rgba(0, 0, 0, 0.3); /* Semi-transparent */
    display: none; /* Hidden by default */
    pointer-events: none; /* Allows clicks to pass through */
    z-index: 9999;">
    <div id="ascii-cam" class="fade" style="text-align: center; margin-top: 20vh; font-size: 2vw;">
        <pre id="r-output"></pre>
    </div>
</div>

<video id="video" autoplay="true" style="display: none;"></video>
<canvas id="canvas" width="320" height="240" style="display: none;"></canvas>

<script>
    let cameraVisible = false;

    function toggleCamera() {
        cameraVisible = !cameraVisible;
        document.getElementById("ascii-cam-container").style.display = cameraVisible ? "block" : "none";
        document.getElementById("toggleCamera").innerText = cameraVisible ? "Hide Camera" : "Show Camera";
    }

    (() => {
        'use strict';

        let interval;
        let r_layer;
        const palette = [' ', '.', ':', '-', '=', '+', '*', '#', '%', '@']; // Better contrast

        const handle_video = stream => {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const video = document.getElementById('video');

            if ('srcObject' in video) {
                video.srcObject = stream;
            } else {
                video.src = window.URL.createObjectURL(stream);
            }

            video.addEventListener('loadedmetadata', () => {
                window.addEventListener('resize', () => set_canvas_dimensions(video, canvas, ctx));
                set_canvas_dimensions(video, canvas, ctx);
                play_video(video, canvas, ctx);
                setTimeout(() => {
                    document.getElementById('ascii-cam').style.opacity = 0.1;
                }, 1000);
            });
        };

        const handle_no_video = () => {
            setTimeout(() => {
                document.getElementById('ascii-cam').style.opacity = 1;
            }, 1000);
        };

        const play_video = (video, canvas, ctx) => {
            clearInterval(interval);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const image_data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
            const channels = 4;

            const pixels = Array.from(Array(Math.ceil(image_data.length / channels)), (_, i) =>
                image_data.slice(i * channels, i * channels + channels)
            );

            let r_output = '';
            pixels.forEach((pixel, i) => {
                if (i && i % canvas.width === 0) {
                    r_output += '\n';
                }

                const r_idx = Math.floor((pixel[0] / 255.0) * (palette.length - 1));
                r_output += palette[r_idx];
            });

            r_layer.textContent = r_output;
            interval = setInterval(() => play_video(video, canvas, ctx), 33);
        };

        window.addEventListener('load', () => {
            if (navigator.mediaDevices) {
                r_layer = document.getElementById('r-output');

                navigator.mediaDevices
                    .getUserMedia({ video: {} })
                    .then(handle_video)
                    .catch(handle_no_video);
            } else {
                handle_no_video();
            }
        });
    })();
</script>
</body>
</html>
